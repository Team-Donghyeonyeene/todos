<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Todos</title>
    <style>
        :root {
            --bg-gradient-start: #a18cd1;
            --bg-gradient-end: #fbc2eb;
            --card-bg: #ffffff;
            --accent: #6c5ce7;
            --accent-soft: rgba(108, 92, 231, 0.08);
            --danger: #ff7675;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --border-soft: rgba(0, 0, 0, 0.08);
            --radius-lg: 18px;
            --radius-md: 12px;
            --shadow-soft: 0 18px 35px rgba(0, 0, 0, 0.12);
            --transition-fast: 150ms ease-out;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-main);
        }

        .app {
            width: min(1080px, 100vw - 32px);
            min-height: 620px;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
            border-radius: 26px;
            padding: 24px 28px 26px;
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(18px);
        }

        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 18px;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-dot {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            background: conic-gradient(from 210deg, #ffeaa7, #fab1a0, #fd79a8, #6c5ce7, #ffeaa7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
        }

        .app-title-main {
            font-weight: 700;
            letter-spacing: 0.03em;
            font-size: 22px;
        }

        .app-title-sub {
            font-size: 12px;
            color: var(--text-sub);
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 10px;
            border-radius: 999px;
            background: rgba(255,255,255,0.9);
            border: 1px solid rgba(255,255,255,0.8);
        }

        .pill-text {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--accent);
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(108, 92, 231, 0.08);
        }

        .date-selector input[type="date"] {
            border: none;
            background: transparent;
            font-size: 14px;
            color: var(--text-main);
            padding: 4px 2px;
            outline: none;
        }

        .date-selector span {
            font-size: 13px;
            color: var(--text-sub);
        }

        .content-grid {
            display: grid;
            grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.1fr);
            gap: 18px;
            margin-top: 8px;
        }

        .panel {
            padding: 14px 16px 16px;
            background: rgba(255,255,255,0.98);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-soft);
            box-shadow: 0 10px 18px rgba(0,0,0,0.04);
            display: flex;
            flex-direction: column;
            min-height: 260px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
        }

        .panel-subtitle {
            font-size: 12px;
            color: var(--text-sub);
        }

        .memo-area {
            resize: vertical;
            min-height: 180px;
            max-height: 260px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-soft);
            padding: 10px 11px;
            font-size: 13px;
            line-height: 1.5;
            font-family: inherit;
            outline: none;
            background: #fcfcff;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
        }

        .memo-area:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(108,92,231,0.3);
            background: #ffffff;
        }

        .memo-footer {
            margin-top: 9px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .helper-text {
            font-size: 11px;
            color: var(--text-sub);
        }

        .btn {
            border-radius: 999px;
            padding: 7px 14px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), opacity var(--transition-fast);
        }

        .btn-primary {
            background: linear-gradient(135deg, #6c5ce7, #a363d9);
            color: white;
            box-shadow: 0 10px 18px rgba(108,92,231,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 24px rgba(108,92,231,0.35);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 6px 14px rgba(108,92,231,0.25);
        }

        .btn-icon {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            border: none;
            background: transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
            transition: background var(--transition-fast), transform var(--transition-fast), opacity var(--transition-fast);
        }

        .btn-icon:hover {
            background: rgba(0,0,0,0.04);
            transform: translateY(-0.5px);
        }

        .btn-icon.delete {
            color: var(--danger);
        }

        .btn-icon.delete:hover {
            background: rgba(255,118,117,0.08);
        }

        .todo-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .todo-input-row input[type="text"] {
            flex: 1;
            border-radius: 999px;
            border: 1px solid var(--border-soft);
            padding: 8px 12px;
            font-size: 13px;
            outline: none;
            background: #fcfcff;
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
        }

        .todo-input-row input[type="text"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(108,92,231,0.25);
            background: #ffffff;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 3px 8px;
            border-radius: 999px;
            background: var(--accent-soft);
            color: var(--accent);
            font-size: 11px;
            font-weight: 500;
        }

        .tag-dot {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: var(--accent);
        }

        .todo-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
            padding-right: 2px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            padding: 8px 9px;
            border-radius: 13px;
            border: 1px solid rgba(0,0,0,0.04);
            background: #ffffff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.03);
            margin-bottom: 6px;
            transition: box-shadow var(--transition-fast), transform var(--transition-fast), background var(--transition-fast), opacity var(--transition-fast);
        }

        .todo-main {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }

        .todo-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .todo-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        .todo-text {
            font-size: 13px;
            word-break: break-word;
        }

        .todo-text.completed {
            text-decoration: line-through;
            color: var(--text-sub);
            opacity: 0.75;
        }

        .todo-actions {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .todo-item.completed {
            background: #f6f7ff;
        }

        .empty-state {
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-sub);
            text-align: center;
            padding: 18px 10px;
            border-radius: 14px;
            background: #fafafa;
            border: 1px dashed rgba(0,0,0,0.05);
        }

        .toast {
            position: fixed;
            left: 50%;
            bottom: 22px;
            transform: translateX(-50%);
            padding: 9px 14px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(0,0,0,0.78);
            color: white;
            display: none;
            align-items: center;
            gap: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.32);
            z-index: 999;
        }

        .toast.show {
            display: inline-flex;
        }

        .toast span {
            font-size: 11px;
        }

        .toast-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #55efc4;
        }

        @media (max-width: 840px) {
            .app {
                padding: 18px 16px 20px;
                border-radius: 0;
                width: 100vw;
                min-height: 100vh;
            }

            .content-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="app">
    <header class="app-header">
        <div class="app-title">
            <div class="logo-dot">‚úî</div>
            <div>
                <div class="app-title-main">Todos</div>
                <div class="app-title-sub">ÎÇ†ÏßúÎ≥ÑÎ°ú Ï†ïÎ¶¨ÌïòÎäî ÎÇòÎßåÏùò Ìï† Ïùº & Î©îÎ™®</div>
            </div>
        </div>
        <div class="date-selector">
            <span class="pill-text">Ïò§Îäò</span>
            <input type="date" id="datePicker">
            <span id="selectedDateLabel"></span>
        </div>
    </header>

    <main class="content-grid">
        <!-- Memo panel -->
        <section class="panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">Daily Memo</div>
                    <div class="panel-subtitle">ÏÑ†ÌÉùÌïú ÎÇ†ÏßúÏóê ÎåÄÌïú ÏÉùÍ∞ÅÏù¥ÎÇò Í∏∞Î°ùÏùÑ ÏûêÏú†Î°≠Í≤å ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî.</div>
                </div>
            </div>
            <textarea id="memoContent" class="memo-area"
                      placeholder="Ïòà) Ïò§Îäò Í≥µÎ∂ÄÌïú ÎÇ¥Ïö©, ÎäêÎÇÄ Ï†ê, ÎÇ¥Ïùº ÌïòÍ≥† Ïã∂ÏùÄ ÏùºÎì§ÏùÑ Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî."></textarea>
            <div class="memo-footer">
                <div class="helper-text">
                    ÎÇ†ÏßúÍ∞Ä Î∞îÎÄåÎ©¥ Ïù¥ Î©îÎ™®ÎèÑ ÎÇ†ÏßúÎ≥ÑÎ°ú Îî∞Î°ú Ï†ÄÏû•ÎèºÏöî.
                </div>
                <button id="saveMemoBtn" class="btn btn-primary">
                    üíæ Î©îÎ™® Ï†ÄÏû•
                </button>
            </div>
        </section>

        <!-- Todo panel -->
        <section class="panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">Todo List</div>
                    <div class="panel-subtitle">ÏÑ†ÌÉùÌïú ÎÇ†ÏßúÏóê Ìï¥Ïïº Ìï† ÏùºÎì§ÏùÑ Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî.</div>
                </div>
                <div class="tag">
                    <span class="tag-dot"></span>
                    <span id="todoSummaryText">0Í∞ú ÎÇ®Ïùå</span>
                </div>
            </div>

            <div class="todo-input-row">
                <input id="todoInput" type="text" placeholder="Ìï† ÏùºÏùÑ ÏûÖÎ†•ÌïòÍ≥† Enter ÎòêÎäî Ï∂îÍ∞Ä Î≤ÑÌäºÏùÑ ÎàåÎü¨Î≥¥ÏÑ∏Ïöî.">
                <button id="addTodoBtn" class="btn btn-primary">Ôºã Ï∂îÍ∞Ä</button>
            </div>

            <ul id="todoList" class="todo-list"></ul>
            <div id="emptyState" class="empty-state" style="display:none;">
                ÏïÑÏßÅ Ìï† ÏùºÏù¥ ÏóÜÏäµÎãàÎã§. ÏúÑ ÏûÖÎ†•Ï∞ΩÏóê Ïò§Îäò Ìï† ÏùºÏùÑ Ï†ÅÍ≥† <b>Ï∂îÍ∞Ä</b> Î≤ÑÌäºÏùÑ ÎàåÎü¨Î≥¥ÏÑ∏Ïöî.
            </div>
        </section>
    </main>
</div>

<div id="toast" class="toast">
    <div class="toast-dot"></div>
    <span id="toastMessage"></span>
</div>

<script>
    const apiBase = '/api/todos';
    const memoBase = '/api/memos';

    let selectedDate = null;
    let currentTodos = [];

    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().substring(0, 10);
        const datePicker = document.getElementById('datePicker');

        datePicker.value = today;
        selectedDate = today;
        updateSelectedDateLabel();

        datePicker.addEventListener('change', () => {
            selectedDate = datePicker.value;
            updateSelectedDateLabel();
            refreshAll();
        });

        document.getElementById('addTodoBtn').addEventListener('click', addTodo);
        document.getElementById('todoInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addTodo();
            }
        });
        document.getElementById('saveMemoBtn').addEventListener('click', saveMemo);

        refreshAll();
    });

    function updateSelectedDateLabel() {
        const label = document.getElementById('selectedDateLabel');
        if (!selectedDate) {
            label.textContent = '';
            return;
        }
        const [year, month, day] = selectedDate.split('-');
        label.textContent = `${year}ÎÖÑ ${month}Ïõî ${day}Ïùº`;
    }

    function refreshAll() {
        loadTodos();
        loadMemo();
    }

    async function loadTodos() {
        try {
            const res = await fetch(`${apiBase}?date=${selectedDate}`);
            if (!res.ok) {
                throw new Error('TodoÎ•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.');
            }
            const data = await res.json();
            currentTodos = Array.isArray(data) ? data : [];
            renderTodos();
        } catch (e) {
            console.error(e);
            showToast('TodoÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    }

    function renderTodos() {
        const list = document.getElementById('todoList');
        const emptyState = document.getElementById('emptyState');
        list.innerHTML = '';

        if (!currentTodos.length) {
            emptyState.style.display = 'block';
            updateTodoSummary();
            return;
        }

        emptyState.style.display = 'none';

        currentTodos.forEach(todo => {
            const li = document.createElement('li');
            li.className = 'todo-item' + (todo.completed ? ' completed' : '');
            li.dataset.id = todo.id;

            const main = document.createElement('div');
            main.className = 'todo-main';

            const checkboxWrapper = document.createElement('div');
            checkboxWrapper.className = 'todo-checkbox';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = todo.completed;
            checkbox.addEventListener('change', () => toggleTodo(todo.id, todo.task, !todo.completed));

            checkboxWrapper.appendChild(checkbox);

            const textWrapper = document.createElement('div');
            textWrapper.style.flex = '1';

            const text = document.createElement('div');
            text.className = 'todo-text' + (todo.completed ? ' completed' : '');
            text.textContent = todo.task;

            textWrapper.appendChild(text);

            main.appendChild(checkboxWrapper);
            main.appendChild(textWrapper);

            const actions = document.createElement('div');
            actions.className = 'todo-actions';

            const editBtn = document.createElement('button');
            editBtn.className = 'btn-icon';
            editBtn.title = 'ÏàòÏ†ï';
            editBtn.innerHTML = '‚úèÔ∏è';
            editBtn.addEventListener('click', () => editTodo(todo));

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'btn-icon delete';
            deleteBtn.title = 'ÏÇ≠Ï†ú';
            deleteBtn.innerHTML = 'üóë';
            deleteBtn.addEventListener('click', () => deleteTodo(todo.id));

            actions.appendChild(editBtn);
            actions.appendChild(deleteBtn);

            li.appendChild(main);
            li.appendChild(actions);

            list.appendChild(li);
        });

        updateTodoSummary();
    }

    function updateTodoSummary() {
        const remaining = currentTodos.filter(t => !t.completed).length;
        const text = remaining === 0
            ? 'Î™®Îì† ÏùºÏùÑ ÏôÑÎ£åÌñàÏñ¥Ïöî! üéâ'
            : `${remaining}Í∞ú ÎÇ®Ïùå`;
        document.getElementById('todoSummaryText').textContent = text;
    }

    async function addTodo() {
        const input = document.getElementById('todoInput');
        const task = input.value.trim();
        if (!task) {
            showToast('Ìï† ÏùºÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
            input.focus();
            return;
        }

        try {
            const res = await fetch(apiBase, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    task: task,
                    completed: false,
                    date: selectedDate
                })
            });

            if (!res.ok) {
                throw new Error('Todo ÏÉùÏÑ± Ïã§Ìå®');
            }

            input.value = '';
            await loadTodos();
            showToast('Ìï† ÏùºÏùÑ Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§.');
        } catch (e) {
            console.error(e);
            showToast('Ìï† ÏùºÏùÑ Ï∂îÍ∞ÄÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    }

    async function toggleTodo(id, task, completed) {
        try {
            const res = await fetch(`${apiBase}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    task: task,
                    completed: completed,
                    date: selectedDate
                })
            });

            if (!res.ok) {
                throw new Error('Todo ÏàòÏ†ï Ïã§Ìå®');
            }

            await loadTodos();
        } catch (e) {
            console.error(e);
            showToast('ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    }

    async function editTodo(todo) {
        const newText = prompt('Ìï† ÏùºÏùÑ ÏàòÏ†ïÌïòÏÑ∏Ïöî.', todo.task);
        if (newText === null) return;

        const trimmed = newText.trim();
        if (!trimmed) {
            showToast('ÎÇ¥Ïö©Ïù¥ ÎπÑÏñ¥ ÏûàÏäµÎãàÎã§.');
            return;
        }

        try {
            const res = await fetch(`${apiBase}/${todo.id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    task: trimmed,
                    completed: todo.completed,
                    date: selectedDate
                })
            });

            if (!res.ok) {
                throw new Error('Todo ÏàòÏ†ï Ïã§Ìå®');
            }

            await loadTodos();
            showToast('Ìï† ÏùºÏùÑ ÏàòÏ†ïÌñàÏäµÎãàÎã§.');
        } catch (e) {
            console.error(e);
            showToast('Ìï† ÏùºÏùÑ ÏàòÏ†ïÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    }

    async function deleteTodo(id) {
        if (!confirm('Ï†ïÎßê Ïù¥ Ìï† ÏùºÏùÑ ÏÇ≠Ï†úÌï†ÍπåÏöî?')) return;

        try {
            const res = await fetch(`${apiBase}/${id}`, {
                method: 'DELETE'
            });

            if (!res.ok && res.status !== 204) {
                throw new Error('Todo ÏÇ≠Ï†ú Ïã§Ìå®');
            }

            await loadTodos();
            showToast('Ìï† ÏùºÏùÑ ÏÇ≠Ï†úÌñàÏäµÎãàÎã§.');
        } catch (e) {
            console.error(e);
            showToast('Ìï† ÏùºÏùÑ ÏÇ≠Ï†úÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    }

    async function loadMemo() {
        try {
            const res = await fetch(`${memoBase}?date=${selectedDate}`);
            if (!res.ok) {
                throw new Error('Î©îÎ™®Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.');
            }
            const data = await res.json();
            document.getElementById('memoContent').value = data.content || '';
        } catch (e) {
            console.error(e);
            showToast('Î©îÎ™®Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    }

    async function saveMemo() {
        const content = document.getElementById('memoContent').value;

        try {
            const res = await fetch(memoBase, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    date: selectedDate,
                    content: content
                })
            });

            if (!res.ok) {
                throw new Error('Î©îÎ™® Ï†ÄÏû• Ïã§Ìå®');
            }

            await res.json();
            showToast('Î©îÎ™®Î•º Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
        } catch (e) {
            console.error(e);
            showToast('Î©îÎ™®Î•º Ï†ÄÏû•ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    }

    let toastTimeoutId = null;

    function showToast(message) {
        const toast = document.getElementById('toast');
        const msg = document.getElementById('toastMessage');

        msg.textContent = message;
        toast.classList.add('show');

        if (toastTimeoutId) {
            clearTimeout(toastTimeoutId);
        }

        toastTimeoutId = setTimeout(() => {
            toast.classList.remove('show');
        }, 2200);
    }
</script>
</body>
</html>
